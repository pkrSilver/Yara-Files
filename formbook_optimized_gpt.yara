rule Formbook_Optimized
{
    meta:
        description = "Detects Formbook malware family with minimal false positives"
        author = "AutoYara + Analyst"
        date = "2025-12-14"
    strings:
        // Keep only the most specific and rare strings
        $s0 = { 00 6F 00 2E 00 2A 00 4D 00 69 00 73 00 73 00 69 00 6E 00 67 00 20 00 73 00 65 00 70 00 61 00 72 00 61 00 74 00 6F 00 72 00 20 00 63 00 68 00 61 00 72 00 61 00 63 00 74 00 65 00 72 00 20 00 61 00 66 00 74 00 65 00 72 00 20 00 6B 00 65 00 79 00 77 00 6F 00 72 00 64 00 2E 00 00 00 00 00 00 00 A3 48 4B BE 98 6C 4A A9 99 4C 53 0A 86 D6 48 7D 41 55 33 21 45 41 30 36 4D A8 FF 73 24 A7 3C F6 7A 12 F1 67 AC C1 93 E7 6B 43 CA 52 A6 AD 00 00 E1 BB 3A 21 A5 29 E3 EC E7 0B 98 2E 40 BD E1 9A DE 80 46 B1 9D 6B 3B 21 D4 B1 D6 75 3A C8 3D C6 D0 33 F7 14 AF CB 17 A2 94 01 8D 13 88 FE 64 95 61 E7 B6 4D 62 F8 00 00 6C FE 74 84 6A 78 49 F1 B5 91 05 38 EE 76 1E F9 D2 72 0B 54 8D 83 9D 74 78 48 10 8D 21 E7 DC 29 39 38 4F B5 FD 09 2C E4 58 4F 67 3B 4D 6D 98 3D 98 98 41 A4 FC 46 50 }
        $s1 = { 2A 60 12 71 2F BF 51 11 85 B6 C0 09 C9 EE 9D 28 5E F1 66 C7 DC E0 BA 67 EB 6C DC F9 2D CB 05 FB A8 5F 32 32 B0 10 D6 34 CE 1D 0B C5 D8 AE A4 03 4A C2 34 83 AD B8 67 12 FB EE 0B 06 9F 8D 36 3C DE EA 47 9B 98 91 27 61 E3 FC BF 40 8F AE 0D 7F 95 99 3A 5C 3C BC F6 90 D9 28 33 F8 92 A3 FE B3 3B 3D CF 01 31 C4 03 95 8C 72 CB 0B 68 3E 65 53 EF 53 7E 39 04 AC 39 F3 20 B5 FF 39 39 8F E2 2E 2B 94 31 95 4F 4C 69 96 17 F0 E9 DD 9B DE DC E7 76 31 0A CD C3 1A FD 9D 43 65 D5 D0 FE B0 BB F8 7C 77 40 98 83 5E 44 4A 3D D9 FA 6A AE 38 F3 90 E5 E4 EA 1A 0C BE B8 A3 FC 84 BF D4 01 21 F6 8B D2 B1 D4 A4 B1 51 87 17 4F A3 EB C8 2D 47 C9 48 D2 86 D4 FD 24 66 66 C5 27 C8 AF CA 28 BA 82 FC 5B F5 9C 0F D2 77 A5 07 6E CB 29 3B 93 B9 30 07 F7 97 DC 6A F5 24 5A AA C3 28 FE D9 8F 1B A6 3F }
        $s2 = { 00 45 78 69 74 57 69 6E 64 6F 77 73 45 78 00 31 03 6D 6F 75 73 65 5F 65 76 65 6E 74 00 EF 01 4C 6F 61 64 49 6D 61 67 65 57 00 00 19 02 4D 6F 6E 69 74 6F 72 46 72 6F 6D 52 65 63 74 00 2D 00 43 68 61 72 4C 6F 77 65 72 42 75 66 66 57 00 00 08 03 55 6E 72 65 67 69 73 74 65 72 48 6F 74 4B 65 79 00 00 38 01 47 65 74 49 6E 70 75 74 53 74 61 74 65 00 33 02 50 65 65 6B 4D 65 73 73 61 67 65 57 00 00 FC 02 54 72 61 6E 73 6C 61 74 65 4D 65 73 73 61 67 65 00 00 AF 00 44 69 73 70 61 74 63 68 4D 65 73 73 61 67 65 57 00 00 FD 01 4C 6F 63 6B 57 69 6E 64 6F 77 55 70 64 61 74 65 00 00 5D 01 47 65 74 4D 65 73 73 61 67 65 57 00 0F 00 42 6C 6F 63 6B 49 6E 70 75 74 00 00 26 02 4F 70 65 6E 43 6C 69 70 62 6F 61 72 64 00 CA 01 49 73 43 6C 69 70 62 6F 61 72 64 46 6F 72 6D 61 74 41 76 }
        $s3 = { 96 5B 00 9C 95 5A 00 99 99 5C 00 A0 81 4D 00 A3 83 53 00 A4 81 51 00 A2 86 54 00 A8 83 57 00 A0 8A 55 00 A7 87 58 00 A8 85 58 00 A5 89 59 00 A5 8C 5B 00 A4 8E 5C 00 AA 8A 5E 00 A9 8C 5F 00 A0 90 5A 00 A2 92 5D 00 A1 95 5F 00 84 A0 57 00 82 A2 58 00 80 A4 5A 00 9E 9A 61 00 9D 9D 62 00 9C 9F 64 00 A9 8F 60 00 B3 88 63 00 B1 8D 65 00 A7 93 61 00 A0 97 60 00 A5 95 62 00 A8 91 61 00 AC 91 65 00 AA 96 66 00 A3 9B 66 00 A4 98 64 00 A2 9D 67 00 AD 95 69 00 AF 97 6C 00 A9 99 68 00 AD 99 6D 00 AA 9C 6C 00 AD 9D 6F 00 B1 9E 72 00 9B A1 65 00 9D A4 6A 00 9D B3 79 00 99 B7 7C 00 95 BA 7E 00 A8 A1 6E 00 A5 A7 71 00 A2 AC 74 00 B4 A3 79 00 A0 B0 76 00 88 84 81 00 B2 A6 A6 00 B3 A8 A7 00 C1 B6 B5 00 D1 BD BC 00 8B C5 87 00 90 C1 84 00 D1 C6 BD 00 BE BF C0 00 DA DA DA 00 DD }
        $s4 = { FF 01 1C 05 FF 4C 00 13 FF 00 81 00 FF 74 00 C4 FF 09 A5 18 FF 9D 05 54 FF 02 F1 0B FF 43 03 43 FF 00 43 04 FF 00 00 43 FF 00 00 00 FF 00 02 13 FF 03 60 00 FF 81 01 ED FF 09 A5 00 FF 2E 05 7B FF 73 41 74 FF 00 63 23 FF 73 00 79 FF 73 75 53 FF 67 6E 69 FF 65 70 79 FF 02 19 00 FF 61 6C 6C FF 69 42 64 FF 62 65 44 FF 4E 65 76 FF 6E 65 47 FF 00 61 00 FF 54 00 6C FF 00 6F 00 FF 32 00 63 FF 80 12 06 FF 04 0E 0E FF 06 08 91 FF 77 74 66 FF 07 05 1D FF 01 07 03 FF 00 00 00 FF 74 00 63 FF 00 28 00 FF 00 00 00 FF 00 00 00 FF 50 00 AD FF C6 E5 AD FF 18 41 7E FF AA C3 49 FF 4D E3 15 FF FC 46 8B FF 27 14 56 FF AC 4C BC FF 8A 8C A2 FF E4 CB 02 FF EE 21 CB FF DE 4A 1A FF C8 FE C9 FF BB 59 73 FF EF 8F 72 FF 8F 53 2F FF DC BD 28 FF 93 75 B8 FF 5B 58 03 FF 48 29 92 FF E1 CD E6 }
        $s5 = { 85 0D 84 04 01 00 00 14 84 04 01 00 79 02 84 04 01 00 8B 02 9F 04 01 00 23 0D 90 04 01 00 CE 13 88 04 01 00 ED 13 88 04 01 00 E3 13 88 04 01 00 D9 13 88 04 01 00 F7 13 88 04 01 00 BF 1A 88 04 01 00 1E 11 88 04 01 00 20 02 88 04 01 00 C2 01 88 04 11 00 B2 10 AD 04 11 00 19 08 B2 04 11 00 A0 04 B7 04 33 01 4C 01 BB 04 36 00 1A 01 BF 04 16 00 1E 00 C3 04 50 20 00 00 00 00 86 18 A9 15 06 00 01 00 28 21 00 00 00 00 96 00 8C 18 CB 04 01 00 B8 23 00 00 00 00 81 00 84 03 D6 04 03 00 C4 23 00 00 00 00 86 00 37 1B 06 00 05 00 78 24 00 00 00 00 81 00 6F 0E D6 04 05 00 F0 24 00 00 00 00 81 00 27 0E D6 04 07 00 C4 25 00 00 00 00 86 00 D5 05 06 00 09 00 38 26 00 00 00 00 86 00 C5 02 06 00 09 00 14 28 00 00 00 00 81 00 7D 0E D6 04 09 00 38 28 00 00 00 00 81 00 01 0F D6 04 }
        $s6 = { 00 50 00 72 00 6F 00 64 00 75 00 63 00 74 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 31 00 2E 00 30 00 2E 00 30 00 2E 00 30 00 00 00 38 00 08 00 01 00 41 00 73 00 73 00 65 00 6D 00 62 00 6C 00 79 00 20 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 31 00 2E 00 30 00 2E 00 30 00 2E 00 30 00 00 00 48 C4 0A 00 EA 01 00 00 00 00 00 00 00 00 00 00 EF BB BF 3C 3F 78 6D 6C 20 76 65 72 73 69 6F 6E 3D 22 31 2E 30 22 20 65 6E 63 6F 64 69 6E 67 3D 22 55 54 46 2D 38 22 20 73 74 61 6E 64 61 6C 6F 6E 65 3D 22 79 65 73 22 3F 3E 0D 0A 0D 0A 3C 61 73 73 65 6D 62 6C 79 20 78 6D 6C 6E 73 3D 22 75 72 6E 3A 73 63 68 65 6D 61 73 2D 6D 69 63 72 6F 73 6F 66 74 2D 63 6F 6D 3A 61 73 6D 2E 76 31 22 20 6D 61 6E 69 66 65 73 74 56 65 72 73 69 6F 6E 3D 22 31 2E 30 22 3E 0D 0A }
        // ...add more if you find Formbook-specific strings...

    condition:
        4 of ($s*) // Adjust threshold based on testing
}
